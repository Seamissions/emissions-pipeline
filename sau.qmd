---
title: "Sea Around Us"
author: "Carmen Hoyt"
date: last-modified
format:
  html:
      toc: true
      code-fold: true
editor: visual
execute:
  warning: false
  messages: false
editor_options: 
  chunk_output_type: console
---

Load Packages

```{r}
#| code-summary: Expand code
library(tidyverse)
library(janitor)
library(here)
```

Import Data

```{r}
#| code-summary: Expand code
# add iso flag code
iso_flags <- read_csv("/capstone/seamissions/data/fao_seafood_production/CL_FI_COUNTRY_GROUPS.csv", show_col_types = FALSE) %>%
  clean_names() %>%
  select(iso3_code, name_en)

# Set up import for .csv files
file_names <- list.files("/capstone/seamissions/data/sau", pattern="*.csv", full.names = TRUE)

sau_regions <- vector("list", length = length(file_names))

# Read in emissions data files
for (i in seq_along(file_names)) {
  table_name <- paste0("region_", str_sub(file_names[i], 40, 41))
  sau_regions[[i]] <- assign(table_name, read_csv(file_names[i], show_col_types = FALSE) %>%
           clean_names()) %>%
    # some are characters? 
    mutate(year = as.numeric(year))
}

check <- sau_regions[[4]]

# clean sau_regions
clean_sau_regions <- lapply(sau_regions, function(df) {
  df %>%
    filter(year >= 2015) %>%
           left_join(iso_flags, by = c("fishing_entity" = "name_en")) %>%
           mutate(iso3_code = ifelse(is.na(iso3_code), fishing_entity, iso3_code))
})


check_2 <- clean_sau_regions[[4]]

check_2 <- check %>%
  filter(year >= 2015)

# append to list?

unique(region_18$iso3_code)
unique(region_21$iso3_code)
unique(region_27$iso3_code)
unique(region_31$iso3_code)

region_31 <- read_csv("/capstone/seamissions/data/sau/SAU FAO 31 v50-1.csv", show_col_types = FALSE) %>%
  clean_names()
#problem files
#31
```
